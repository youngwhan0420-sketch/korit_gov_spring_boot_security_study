spring security는
인증(Authentication), 인가(Authorize)부여 및 보호 기능을 제공하는 프레임워크
인증은 해당 사용자가 본인이 맞는지 확인하는 절차
인가는 인증된 사용자 요청된 자원에 접근이 가능한지 확인하는 절차

필터
securityFilterChain안에
securityContextPersistenceFilter, UsernamePasswordAuthenticationFilter, AuthorizationFilter를 거치면서 인증과 인가를 하게된다.

1. 제일먼저 Http Request수신을 해서 요청을 받아 사용자가 로그인 정보와 함께 인증 요청을 한다.





2. 유저 자격을 기반으로 인증 토큰을 생성한다.
AuthenticationFilter가 요청을 가로채고, 가로챈 정보를 통해 UsernamePasswordAuthenticationToken의 인증용 객체를 생성한다.






3. Filter를 통해 AuthenticationToken을 AuthenticationManager로 위임한다.
그러면 AuthenticationManager의 구현체인 ProviderManager에게 생성한 UsernamePasswordToken객체를 전달한다.

4.AuthenticationProvider의 목록으로 인증을 시도
AuthenticationManager는 등록된 AuthenticationProvider들을 조회하면서 인증을 요구한다.



커스텀*
5. UserDetailsService
실제 데이터베이스에서 사용자 인증정보를 가져오는 UserDetailService에 사용자 정보를 전달.
6. UserDetails를 이용해 User객체에 대한 정보를 탐색
=전달 받은 사용자 정보를 통해 데이터베이스에서 찾아낸 사용자 정보인 UserDetails객체를 만든다.
7. User객체의 정보들을 UserDetails가 UserDetailsService로 전달
= AuthenticationProvider들은 UserDetails를 넘겨받고 사용자 정보를 비교





8.인증 객체(인증 성공) 또는 AuthenticationException(인증 실패했을 경우) 발생한다


9.만들어지면
securityContext에 인증 객체를 설정한다.
=최종적으로는 SecurityContextHolder는 세션 영역에 있는 SecurityContext에 Authentication객체를 저장한다.
